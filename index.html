<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë‘ë°”ì´ì«€ë“ì¿ í‚¤: ì‚¬ë¨¹ì ì„œë¯¼ë“¤ì•„</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        * { box-sizing: border-box; }
        body { text-align: center; background: #1a1a1a; font-family: 'Jua', sans-serif; margin: 0; padding: 0; overflow: hidden; color: white; touch-action: none; display: flex; flex-direction: column; height: 100vh; }
        .ad-top { background: #333; height: 50px; line-height: 50px; font-size: 11px; color: #888; flex-shrink: 0; }
        #ui-header { padding: 15px 10px; background: #222; position: relative; /* ë²„íŠ¼ ë°°ì¹˜ì˜ ê¸°ì¤€ì  */display: flex; flex-direction: column; align-items: center;justify-content: center;min-height: 110px; /* [ìµœì í™”] ë²„íŠ¼ì´ ë“¤ì–´ê°ˆ ì¶©ë¶„í•œ ë†’ì´ í™•ë³´ */}
        .title { color: #ffeb3b; font-size: 1.4rem; margin-bottom: 5px; }
        .price-tag { color: #ff5252; font-size: 1.1rem; }
        .stats-text { font-size: 1.2rem; color: #4caf50; }
        .time-text { font-size: 1.1rem; color: #2196f3; }
        .best-time { font-size: 0.9rem; color: #ff9800; }
        #game-container { flex-grow: 1; position: relative; overflow: hidden; background: #222; display: flex; justify-content: center; }
        canvas { background: #2c2c2c; display: block; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #start-screen { background-color: #1a1a1a; background-image: url('start.png'); background-size: contain; background-position: center; background-repeat: no-repeat; }
        .overlay h1 { color: #ffeb3b; font-size: 2.5rem; margin-bottom: 20px; text-shadow: 2px 2px #000; }
        .overlay p { text-shadow: 2px 2px #000; }
        .start-content { background: rgba(0, 0, 0, 0.7); padding: 30px 40px; border-radius: 20px; margin-bottom: 20px; backdrop-filter: blur(5px); }
        .btn-main { padding: 15px 40px; font-size: 1.5rem; font-family: 'Jua'; background: #4caf50; color: white; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 0 #2e7d32; }
        #hint-box { position: absolute; top: 50%; z-index: 30; pointer-events: none; }
        #hint-box img { width: 80px; height: auto; display: inline-block; vertical-align: middle; margin-right: 10px; object-fit: contain; }
        #hint-box-text { display: inline-block; vertical-align: middle; color: white; font-size: 1.4rem; line-height: 1.5; font-weight: normal; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
        #hint-box-text .highlight { color: #ffeb3b; }
        #buy-btn { position: absolute; top: 50%; transform: translateY(-50%); width: 90px; height: 90px; border-radius: 50%; border: none; background: #555; color: #888; font-family: 'Jua'; font-size: 1.2rem; cursor: pointer; z-index: 30; box-shadow: 0 6px 0 #333; outline: none; padding: 0; overflow: hidden; transition: background 0.3s, box-shadow 0.3s; }
        #buy-btn img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.6; transition: opacity 0.3s, filter 0.3s; filter: grayscale(100%); }
        #buy-btn.active { background: #ffeb3b; box-shadow: 0 6px 0 #c4a700; }
        #buy-btn.active img { opacity: 1; filter: grayscale(0%); }
        #buy-btn-text { position: absolute; bottom: 5px; left: 0; right: 0; font-size: 0.9rem; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.8); font-weight: bold; z-index: 2; text-align: center; }
        #buy-btn-mobile { display: none; }
        /* íŒì—… ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        #msg-pop { position: absolute; width: 100%; top: 30%; left: 0; font-size: 2.2rem; display: none; text-shadow: 3px 3px #000; z-index: 20; font-weight: bold; pointer-events: none; }
        /* í•˜ë‹¨ ê´‘ê³  ì˜ì—­ í™•ëŒ€ (ìˆ˜ìµ ê·¹ëŒ€í™” ë°°ì¹˜) */
        .ad-bottom { 
            background: #333; 
            height: 250px; /* í° ì‚¬ê°í˜• ê´‘ê³ (Medium Rectangle)ê°€ ë“¤ì–´ê°ˆ ìˆ˜ ìˆëŠ” í¬ê¸° */
            line-height: 250px; 
            color: #ffeb3b; 
            font-size: 16px; 
            flex-shrink: 0; 
            border-top: 4px solid #444;
        }
        
        @media (max-width: 768px) {
            .ad-bottom {
                height: 100px;
                line-height: 100px;
                font-size: 14px;
            }
        }
        /* ì „ë©´ ê´‘ê³ ìš© ì˜¤ë²„ë ˆì´ (ì„±ê³µ ì‹œ ë…¸ì¶œ) */
        #interstitial-ad {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 200;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .ad-placeholder {
            width: 300px; height: 450px; background: #444; border: 2px dashed #999;
            display: flex; align-items: center; justify-content: center; color: #888;
        }
        
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ */
        @media (max-width: 768px) {
            #hint-box { 
                display: none !important;
            }
            #buy-btn { 
                display: none !important;
            }
            #buy-btn-mobile { 
                display: block !important; 
                position: absolute;
                top: 50%;           
                right: 15px;        
                transform: translateY(-50%); 
                width: 75px;        
                height: 75px;
                border-radius: 50%;
                border: none;
                background: #555;
                color: #888;
                font-family: 'Jua';
                font-size: 1.2rem;
                cursor: pointer;
                z-index: 50;
                box-shadow: 0 6px 0 #333;
                outline: none;
                padding: 0;
                overflow: hidden;
                transition: background 0.3s, box-shadow 0.3s;
            }
            #buy-btn-mobile img { 
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                object-fit: cover;
                opacity: 0.6;
                transition: opacity 0.3s, filter 0.3s;
                filter: grayscale(100%);
            }
            #buy-btn-mobile.active { 
                background: #ffeb3b;
                box-shadow: 0 6px 0 #c4a700;
            }
            #buy-btn-mobile.active img { 
                opacity: 1;
                filter: grayscale(0%);
            }
            #buy-btn-text-mobile { 
                position: absolute;
                bottom: 5px;
                left: 0;
                right: 0;
                font-size: 0.75rem;
                color: white;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
                font-weight: bold;
                z-index: 2;
                text-align: center;
            }
            #ui-header { 
                padding: 15px 10px;
                align-items: center;
            }
            .stats-text { font-size: 1rem; }
            .time-text { font-size: 0.9rem; }
            .title { font-size: 1.2rem; }
            .price-tag { font-size: 1rem; }
            .start-content { padding: 20px 25px; }
            .overlay h1 { font-size: 2rem; }
        }
        
        @media (max-width: 480px) {
            #buy-btn-mobile { 
                width: 60px;
                height: 60px;
                top: 50%;
                right: 8px;
                transform: translateY(-50%);
            }
            #buy-btn-text-mobile { 
                font-size: 0.65rem;
            }
            .stats-text { font-size: 0.9rem; }
            .time-text { font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <div class="ad-top">ê´‘ê³  ì˜ì—­</div>
    <div id="start-screen" class="overlay">
        <div class="start-content">
            <h1>ğŸ’¸<br>ë‘ë°”ì´ì«€ë“ì¿ í‚¤<br>ì‚¬ë¨¹ì ì„œë¯¼ë“¤ì•„</h1>
            <p>í­ë“±í•˜ëŠ” ë¬¼ê°€ë¥¼ ëš«ê³  ì¿ í‚¤ 10ê°œë¥¼ ìŸì·¨í•˜ì‹­ì‹œì˜¤.</p>
        </div>
        <button class="btn-main" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
    </div>
    <div id="end-screen" class="overlay" style="display: none;">
        <h1 style="color: #4caf50;">ğŸ‰ ì„±ê³µí•œ ì„œë¯¼!</h1>
        <p>ë‹¹ì‹ ì€ ì§‘ë…ì˜ ì„œë¯¼ì…ë‹ˆë‹¤.<br>ë‘ë°”ì´ ì¿ í‚¤ 10ê°œë¥¼ ë‹¤ ëª¨ì•˜ìŠµë‹ˆë‹¤!</p>
        <p style="font-size: 1.3rem; color: #ffeb3b; margin: 20px 0;">í”Œë ˆì´ ì‹œê°„: <span id="end-time">0</span>ì´ˆ</p>
        <button class="btn-main" onclick="location.reload()">ë‹¤ì‹œ í•˜ê¸°</button>
    </div>
    <div id="ui-header">
        <div class="title">ğŸ’¸ ë–¡ìƒí•˜ëŠ” ë‘ë°”ì´ì«€ë“ì¿ í‚¤</div>
        <div class="price-tag">í˜„ì¬ ì‹œì„¸: <span id="current-price">4,000</span>ì›</div>
        <div class="stats-text">ì”ê³ : <span id="money">0</span>ì› | ì¿ í‚¤: <span id="inventory" style="color:#ffeb3b">0</span>ê°œ</div>
        <div class="time-text">í”Œë ˆì´ ì‹œê°„: <span id="play-time">0</span>ì´ˆ | ìµœê³  ê¸°ë¡: <span id="best-time" class="best-time">-</span></div>
        <button id="buy-btn-mobile" onclick="buyCookie()">
            <img id="buy-dubai-img-mobile" src="dubai.png" alt="ë‘ë°”ì´">
            <span id="buy-btn-text-mobile">ëˆ ë¶€ì¡±</span>
        </button>
    </div>
    <div id="game-container">
        <div id="hint-box">
            <span id="hint-box-text">ëˆì„ ëª¨ì•„ ì˜¤ë¥¸ìª½ ë²„íŠ¼ìœ¼ë¡œ<br><span class="highlight">ë‘ì«€ì¿  10ê°œ</span>ë¥¼ êµ¬ë§¤í•˜ì„¸ìš”</span>
        </div>
        <div id="msg-pop"></div>
        <canvas id="gameCanvas"></canvas>
        <button id="buy-btn" onclick="buyCookie()">
            <img id="buy-dubai-img" src="dubai.png" alt="ë‘ë°”ì´">
            <span id="buy-btn-text">ëˆ ë¶€ì¡±</span>
        </button>
    </div>
    <div class="ad-bottom">ê´‘ê³  ì˜ì—­</div>
    <div id="interstitial-ad">
        <div style="margin-bottom: 20px; color: #ffeb3b;">â–¼ ì „ë©´ ê´‘ê³  ì˜ì—­ (ìˆ˜ìµ 5ë°°!)</div>
        <div class="ad-placeholder">ì—¬ê¸°ì— êµ¬ê¸€ ì „ë©´ ê´‘ê³  ì½”ë“œê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.</div>
        <button class="btn-main" style="margin-top: 20px; background: #666;" onclick="closeAd()">ê´‘ê³  ë‹«ê³  ê²°ê³¼ ë³´ê¸°</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        // ì´ë¯¸ì§€ ë Œë”ë§ í’ˆì§ˆ ê°œì„ 
        ctx.imageSmoothingEnabled = true;
        ctx.imageSmoothingQuality = 'high';
        const buyBtn = document.getElementById('buy-btn');
        const msgPop = document.getElementById('msg-pop');
        const container = document.getElementById('game-container');
        
        let gameState = 'ready';
        let money = 0, cookiePrice = 4000, inventory = 0;
        let items = [], particles = [];
        let basket = { x: 0, y: 0, w: 80, h: 80 };
        let globalSpeed = 6, spawnRate = 650, lastSpawnTime = 0;
        let gameStartTime = 0;
        let gameTimer = null;
        
        // ìµœê³  ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadBestTime() {
            const bestTime = localStorage.getItem('dubaiCookieBestTime');
            if (bestTime) {
                document.getElementById('best-time').textContent = parseFloat(bestTime).toFixed(1) + 'ì´ˆ';
            }
        }
        
        // ìµœê³  ê¸°ë¡ ì €ì¥
        function saveBestTime(time) {
            const bestTime = localStorage.getItem('dubaiCookieBestTime');
            if (!bestTime || parseFloat(time) < parseFloat(bestTime)) {
                localStorage.setItem('dubaiCookieBestTime', time.toString());
                document.getElementById('best-time').textContent = parseFloat(time).toFixed(1) + 'ì´ˆ';
            }
        }
        
        loadBestTime();

        const failMsgs = ["ì”ê³  ë–¡ë½", "ë¬´ì†Œìœ  ì‹¤ì²œ", "ê¸°ë¶€ì²œì‚¬", "ì–´ì´ì¿ ", "ì•„ì´ì¿ "];
        const imgDdong = new Image(); imgDdong.src = 'ddong.png';
        const imgDubai = new Image(); imgDubai.src = 'dubai.png';
        const imgCoin = new Image(); imgCoin.src = 'coin.png';
        const imgBackground = new Image(); imgBackground.src = 'start.png'; // ë°°ê²½ ì´ë¯¸ì§€ (í•„ìš”ì‹œ ë‹¤ë¥¸ ì´ë¯¸ì§€ë¡œ ë³€ê²½ ê°€ëŠ¥)

        function resizeCanvas() {
            canvas.width = Math.min(container.clientWidth, 500);
            canvas.height = container.clientHeight;
            basket.x = canvas.width / 2 - 40;
            basket.y = canvas.height - 90;
            
            // canvasì˜ ì‹¤ì œ ìœ„ì¹˜ë¥¼ getBoundingClientRectë¡œ ì •í™•íˆ ê³„ì‚°
            setTimeout(() => {
                const canvasRect = canvas.getBoundingClientRect();
                const containerRect = container.getBoundingClientRect();
                const spacing = 20; // canvasì™€ ì¢Œìš° ìš”ì†Œ ì‚¬ì´ì˜ ê°„ê²©
                
                // canvasì˜ ì™¼ìª½ ë ìœ„ì¹˜ (container ê¸°ì¤€)
                const canvasLeftInContainer = canvasRect.left - containerRect.left;
                // canvasì˜ ì˜¤ë¥¸ìª½ ë ìœ„ì¹˜ (container ê¸°ì¤€)
                const canvasRightInContainer = canvasRect.right - containerRect.left;
                
                // íŒíŠ¸ ë°•ìŠ¤ë¥¼ canvas ì™¼ìª½ ë°–ì— ë°°ì¹˜
                const hintBox = document.getElementById('hint-box');
                hintBox.style.left = (canvasLeftInContainer - spacing) + 'px';
                hintBox.style.transform = 'translateX(-100%) translateY(-50%)';
                hintBox.style.textAlign = 'right';
                
                // êµ¬ë§¤ ë²„íŠ¼ì„ canvas ì˜¤ë¥¸ìª½ ë°–ì— ë°°ì¹˜ (ë°ìŠ¤í¬í†±ë§Œ)
                if (window.innerWidth > 768) {
                    const btnLeft = canvasRightInContainer + spacing;
                    buyBtn.style.left = btnLeft + 'px';
                    buyBtn.style.right = 'auto';
                    buyBtn.style.position = 'absolute';
                    buyBtn.style.bottom = 'auto';
                    buyBtn.style.top = '50%';
                    buyBtn.style.transform = 'translateY(-50%)';
                }
                // ëª¨ë°”ì¼ì€ CSSì˜ fixed positionìœ¼ë¡œ ì²˜ë¦¬
            }, 0);
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function startGame() {
            if (gameState !== 'ready') return;
            gameState = 'playing';
            document.getElementById('start-screen').style.display = 'none';
            lastSpawnTime = performance.now();
            gameStartTime = performance.now();
            
            // íƒ€ì´ë¨¸ ì‹œì‘
            gameTimer = setInterval(() => {
                if (gameState === 'playing') {
                    const elapsed = (performance.now() - gameStartTime) / 1000;
                    document.getElementById('play-time').textContent = elapsed.toFixed(1);
                }
            }, 100);
            
            requestAnimationFrame(gameLoop);
        }

        setInterval(() => {
            if (gameState !== 'playing') return;
            cookiePrice += Math.floor(Math.random() * 150) + 150;
            document.getElementById('current-price').innerText = cookiePrice.toLocaleString();
            updateBuyButton();
        }, 1200);

        function updateBuyButton() {
            const buyBtnText = document.getElementById('buy-btn-text');
            const buyBtnMobile = document.getElementById('buy-btn-mobile');
            const buyBtnTextMobile = document.getElementById('buy-btn-text-mobile');
            
            if (money >= cookiePrice) {
                buyBtn.classList.add('active');
                buyBtnText.textContent = "êµ¬ë§¤";
                if (buyBtnMobile) {
                    buyBtnMobile.classList.add('active');
                    buyBtnTextMobile.textContent = "êµ¬ë§¤";
                }
            } else {
                buyBtn.classList.remove('active');
                buyBtnText.textContent = "ëˆ ë¶€ì¡±";
                if (buyBtnMobile) {
                    buyBtnMobile.classList.remove('active');
                    buyBtnTextMobile.textContent = "ëˆ ë¶€ì¡±";
                }
            }
        }

        function showMsg(text, color) {
            msgPop.innerText = text;
            msgPop.style.color = color;
            msgPop.style.display = 'block';
            setTimeout(() => { msgPop.style.display = 'none'; }, 700);
        }

        function createParticle(x, y, text, color) {
            particles.push({ x, y, text, color, opacity: 1, life: 40 });
        }

        function buyCookie() {
            if (gameState !== 'playing') return;
            if (money >= cookiePrice) {
                money -= cookiePrice;
                inventory++;
                showMsg("Flex!", "#ffeb3b");
                updateBuyButton();
                globalSpeed += 0.5;
                spawnRate = Math.max(150, spawnRate - 60);
                if (inventory >= 10) endGame();
            }
        }

        function endGame() {
            gameState = 'end';
            
            // íƒ€ì´ë¨¸ ì •ì§€ ë° ìµœê³  ê¸°ë¡ ì €ì¥
            if (gameTimer) {
                clearInterval(gameTimer);
                gameTimer = null;
            }
            const finalTime = (performance.now() - gameStartTime) / 1000;
            saveBestTime(finalTime);
            
            // 1. ë¨¼ì € ì „ë©´ ê´‘ê³ ë¥¼ ë³´ì—¬ì¤Œ
            document.getElementById('interstitial-ad').style.display = 'flex';
        }

        // ê´‘ê³  ë‹«ê¸° í•¨ìˆ˜
        function closeAd() {
            document.getElementById('interstitial-ad').style.display = 'none';
            // 2. ê·¸ ë‹¤ìŒ ì„±ê³µ í™”ë©´ì„ ë³´ì—¬ì¤Œ
            const finalTime = (performance.now() - gameStartTime) / 1000;
            document.getElementById('end-time').textContent = finalTime.toFixed(1);
            document.getElementById('end-screen').style.display = 'flex';
        }

        function spawnItem() {
            const rand = Math.random();
            let type = (rand < 0.25) ? 'poop' : (rand < 0.30 ? 'real' : 'coin');
            items.push({ x: Math.random() * (canvas.width - 50), y: -50, type: type, speed: globalSpeed + Math.random() * 2 });
        }

        function update(time) {
            if (time - lastSpawnTime > 2000) lastSpawnTime = time;
            if (time - lastSpawnTime > spawnRate) {
                spawnItem();
                lastSpawnTime = time;
            }

            for (let i = items.length - 1; i >= 0; i--) {
                items[i].y += items[i].speed;
                if (items[i].y + 40 > basket.y && items[i].x < basket.x + basket.w && items[i].x + 40 > basket.x) {
                    if (items[i].type === 'coin') {
                        money += 500;
                        createParticle(items[i].x, items[i].y, "+500", "#4caf50");
                    } else if (items[i].type === 'poop') {
                        let loss = Math.floor(money * 0.3);
                        money -= loss;
                        createParticle(items[i].x, items[i].y, `-${loss}`, "#ff5252");
                        showMsg(failMsgs[Math.floor(Math.random() * failMsgs.length)], "#ff5252");
                    } else if (items[i].type === 'real') {
                        inventory++;
                        showMsg("ëŸ­í‚¤!", "#4caf50");
                        if (inventory >= 10) endGame();
                    }
                    updateBuyButton();
                    items.splice(i, 1);
                    continue;
                }
                if (items[i].y > canvas.height) items.splice(i, 1);
            }

            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].y -= 1.2;
                particles[i].opacity -= 0.025;
                if (particles[i].opacity <= 0) particles.splice(i, 1);
            }

            document.getElementById('money').innerText = money.toLocaleString();
            document.getElementById('inventory').innerText = inventory;
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ë°°ê²½ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
            if (imgBackground.complete && imgBackground.naturalWidth > 0) {
                ctx.save();
                ctx.globalAlpha = 0.5; // ë°°ê²½ ì´ë¯¸ì§€ë¥¼ ë°˜íˆ¬ëª…í•˜ê²Œ
                ctx.drawImage(imgBackground, 0, 0, canvas.width, canvas.height);
                ctx.restore();
            } else {
                // ë°°ê²½ ì´ë¯¸ì§€ê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ ë°°ê²½ìƒ‰
                ctx.fillStyle = "#2c2c2c";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            // íŒŒí‹°í´(ìˆ«ì íš¨ê³¼) ê·¸ë¦¬ê¸°
            particles.forEach(p => {
                ctx.fillStyle = `rgba(${p.color === '#4caf50' ? '76,175,80' : '255,82,82'}, ${p.opacity})`;
                ctx.font = "bold 22px Jua";
                ctx.fillText(p.text, p.x, p.y);
            });

            ctx.fillStyle = "#5d4037";
            ctx.fillRect(basket.x, basket.y, basket.w, basket.h);
            ctx.fillStyle = "white"; ctx.font = "15px Jua"; ctx.fillText("ì„œë¯¼(ë‚˜)", basket.x + 18, basket.y + 45);

            items.forEach(item => {
                if (item.type === 'coin' && imgCoin.complete && imgCoin.naturalWidth > 0) {
                    const targetHeight = 50;
                    const aspectRatio = imgCoin.naturalWidth / imgCoin.naturalHeight;
                    const targetWidth = targetHeight * aspectRatio;
                    // ê³ í’ˆì§ˆ ë Œë”ë§ì„ ìœ„í•´ ìŠ¤ë¬´ë”© ì¬ì„¤ì •
                    ctx.save();
                    ctx.imageSmoothingEnabled = true;
                    ctx.imageSmoothingQuality = 'high';
                    ctx.drawImage(imgCoin, item.x, item.y, targetWidth, targetHeight);
                    ctx.restore();
                } else if (item.type === 'poop' && imgDdong.complete && imgDdong.naturalWidth > 0) {
                    const targetHeight = 50;
                    const aspectRatio = imgDdong.naturalWidth / imgDdong.naturalHeight;
                    const targetWidth = targetHeight * aspectRatio;
                    ctx.drawImage(imgDdong, item.x, item.y, targetWidth, targetHeight);
                } else if (item.type === 'real' && imgDubai.complete && imgDubai.naturalWidth > 0) {
                    const targetHeight = 50;
                    const aspectRatio = imgDubai.naturalWidth / imgDubai.naturalHeight;
                    const targetWidth = targetHeight * aspectRatio;
                    ctx.drawImage(imgDubai, item.x, item.y, targetWidth, targetHeight);
                } else {
                    ctx.font = "40px Arial";
                    let icon = item.type === 'coin' ? "ğŸª™" : (item.type === 'poop' ? "ğŸ’©" : "ğŸª");
                    ctx.fillText(icon, item.x, item.y + 35);
                }
            });
        }

        const moveBasket = (e) => {
            if (gameState !== 'playing') return;
            let clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            let rect = canvas.getBoundingClientRect();
            basket.x = clientX - rect.left - basket.w / 2;
            if (basket.x < 0) basket.x = 0;
            if (basket.x > canvas.width - basket.w) basket.x = canvas.width - basket.w;
        };

        window.addEventListener('mousemove', moveBasket);
        window.addEventListener('touchmove', moveBasket, { passive: false });

        function gameLoop(time) {
            if (gameState === 'playing') {
                update(time);
                draw();
                requestAnimationFrame(gameLoop);
            }
        }
    </script>
</body>
</html>
